var cov_g99mjt339=function(){var path="C:\\Users\\Bibek Gurung\\Documents\\QA Bursary Project\\Github\\0519(MAY)\\14-05-2019\\bursaryproject\\NodeExpress(old)\\routes\\trainee_routes.js";var hash="f5dc5425c45d6175a76b328e68a8ca2fb7c49697";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Bibek Gurung\\Documents\\QA Bursary Project\\Github\\0519(MAY)\\14-05-2019\\bursaryproject\\NodeExpress(old)\\routes\\trainee_routes.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:32}},"1":{start:{line:2,column:20},end:{line:2,column:36}},"2":{start:{line:4,column:15},end:{line:4,column:32}},"3":{start:{line:5,column:19},end:{line:5,column:40}},"4":{start:{line:6,column:15},end:{line:6,column:32}},"5":{start:{line:8,column:31},end:{line:8,column:66}},"6":{start:{line:9,column:15},end:{line:9,column:35}},"7":{start:{line:11,column:15},end:{line:11,column:35}},"8":{start:{line:12,column:18},end:{line:12,column:64}},"9":{start:{line:14,column:14},end:{line:14,column:48}},"10":{start:{line:16,column:0},end:{line:16,column:26}},"11":{start:{line:19,column:0},end:{line:27,column:3}},"12":{start:{line:20,column:4},end:{line:26,column:7}},"13":{start:{line:21,column:8},end:{line:25,column:9}},"14":{start:{line:22,column:12},end:{line:22,column:29}},"15":{start:{line:24,column:12},end:{line:24,column:30}},"16":{start:{line:30,column:0},end:{line:39,column:2}},"17":{start:{line:31,column:13},end:{line:31,column:26}},"18":{start:{line:32,column:4},end:{line:38,column:7}},"19":{start:{line:33,column:9},end:{line:33,column:27}},"20":{start:{line:36,column:8},end:{line:36,column:25}},"21":{start:{line:37,column:8},end:{line:37,column:54}},"22":{start:{line:42,column:0},end:{line:49,column:2}},"23":{start:{line:43,column:4},end:{line:48,column:6}},"24":{start:{line:44,column:8},end:{line:44,column:26}},"25":{start:{line:47,column:8},end:{line:47,column:54}},"26":{start:{line:51,column:0},end:{line:60,column:3}},"27":{start:{line:52,column:18},end:{line:52,column:39}},"28":{start:{line:53,column:4},end:{line:59,column:11}},"29":{start:{line:55,column:12},end:{line:55,column:76}},"30":{start:{line:58,column:12},end:{line:58,column:62}},"31":{start:{line:63,column:0},end:{line:73,column:3}},"32":{start:{line:64,column:4},end:{line:72,column:3}},"33":{start:{line:65,column:8},end:{line:71,column:9}},"34":{start:{line:66,column:12},end:{line:66,column:38}},"35":{start:{line:69,column:12},end:{line:69,column:29}},"36":{start:{line:70,column:12},end:{line:70,column:40}},"37":{start:{line:76,column:0},end:{line:95,column:3}},"38":{start:{line:77,column:4},end:{line:94,column:7}},"39":{start:{line:78,column:8},end:{line:81,column:59}},"40":{start:{line:79,column:12},end:{line:79,column:54}},"41":{start:{line:81,column:12},end:{line:81,column:59}},"42":{start:{line:82,column:12},end:{line:82,column:59}},"43":{start:{line:83,column:12},end:{line:83,column:59}},"44":{start:{line:84,column:3},end:{line:84,column:58}},"45":{start:{line:85,column:12},end:{line:85,column:69}},"46":{start:{line:86,column:12},end:{line:86,column:67}},"47":{start:{line:88,column:12},end:{line:93,column:15}},"48":{start:{line:89,column:16},end:{line:89,column:45}},"49":{start:{line:92,column:16},end:{line:92,column:60}},"50":{start:{line:98,column:0},end:{line:116,column:3}},"51":{start:{line:99,column:4},end:{line:99,column:21}},"52":{start:{line:100,column:4},end:{line:115,column:7}},"53":{start:{line:101,column:8},end:{line:114,column:9}},"54":{start:{line:102,column:12},end:{line:102,column:54}},"55":{start:{line:105,column:12},end:{line:105,column:69}},"56":{start:{line:106,column:12},end:{line:106,column:65}},"57":{start:{line:108,column:12},end:{line:113,column:15}},"58":{start:{line:109,column:16},end:{line:109,column:45}},"59":{start:{line:112,column:16},end:{line:112,column:60}},"60":{start:{line:119,column:0},end:{line:132,column:5}},"61":{start:{line:120,column:4},end:{line:131,column:7}},"62":{start:{line:121,column:6},end:{line:121,column:29}},"63":{start:{line:122,column:6},end:{line:130,column:7}},"64":{start:{line:123,column:8},end:{line:123,column:71}},"65":{start:{line:124,column:8},end:{line:124,column:78}},"66":{start:{line:126,column:8},end:{line:129,column:11}},"67":{start:{line:135,column:0},end:{line:173,column:3}},"68":{start:{line:136,column:14},end:{line:136,column:72}},"69":{start:{line:137,column:14},end:{line:137,column:72}},"70":{start:{line:138,column:16},end:{line:138,column:74}},"71":{start:{line:139,column:4},end:{line:139,column:66}},"72":{start:{line:140,column:4},end:{line:172,column:7}},"73":{start:{line:141,column:8},end:{line:141,column:28}},"74":{start:{line:142,column:8},end:{line:171,column:9}},"75":{start:{line:143,column:12},end:{line:143,column:55}},"76":{start:{line:146,column:26},end:{line:146,column:64}},"77":{start:{line:147,column:12},end:{line:147,column:51}},"78":{start:{line:148,column:12},end:{line:148,column:68}},"79":{start:{line:149,column:12},end:{line:149,column:68}},"80":{start:{line:149,column:36},end:{line:149,column:66}},"81":{start:{line:150,column:30},end:{line:156,column:14}},"82":{start:{line:157,column:30},end:{line:162,column:13}},"83":{start:{line:164,column:12},end:{line:170,column:15}},"84":{start:{line:165,column:16},end:{line:167,column:17}},"85":{start:{line:166,column:20},end:{line:166,column:46}},"86":{start:{line:168,column:16},end:{line:168,column:82}},"87":{start:{line:169,column:16},end:{line:169,column:62}},"88":{start:{line:176,column:0},end:{line:198,column:3}},"89":{start:{line:177,column:4},end:{line:197,column:7}},"90":{start:{line:178,column:8},end:{line:183,column:120}},"91":{start:{line:179,column:12},end:{line:179,column:54}},"92":{start:{line:183,column:30},end:{line:183,column:119}},"93":{start:{line:185,column:12},end:{line:196,column:17}},"94":{start:{line:186,column:16},end:{line:195,column:19}},"95":{start:{line:187,column:18},end:{line:187,column:51}},"96":{start:{line:188,column:18},end:{line:188,column:71}},"97":{start:{line:189,column:18},end:{line:194,column:19}},"98":{start:{line:190,column:20},end:{line:190,column:50}},"99":{start:{line:193,column:20},end:{line:193,column:64}},"100":{start:{line:200,column:0},end:{line:200,column:31}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:19,column:119},end:{line:19,column:120}},loc:{start:{line:19,column:138},end:{line:27,column:1}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:17},end:{line:20,column:18}},loc:{start:{line:20,column:40},end:{line:26,column:5}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:30,column:32},end:{line:30,column:33}},loc:{start:{line:30,column:51},end:{line:39,column:1}},line:30},"3":{name:"(anonymous_3)",decl:{start:{line:32,column:25},end:{line:32,column:26}},loc:{start:{line:32,column:48},end:{line:34,column:5}},line:32},"4":{name:"(anonymous_4)",decl:{start:{line:35,column:11},end:{line:35,column:12}},loc:{start:{line:35,column:18},end:{line:38,column:5}},line:35},"5":{name:"(anonymous_5)",decl:{start:{line:42,column:40},end:{line:42,column:41}},loc:{start:{line:42,column:58},end:{line:49,column:1}},line:42},"6":{name:"(anonymous_6)",decl:{start:{line:43,column:61},end:{line:43,column:62}},loc:{start:{line:43,column:84},end:{line:45,column:5}},line:43},"7":{name:"(anonymous_7)",decl:{start:{line:46,column:11},end:{line:46,column:12}},loc:{start:{line:46,column:18},end:{line:48,column:5}},line:46},"8":{name:"(anonymous_8)",decl:{start:{line:51,column:33},end:{line:51,column:34}},loc:{start:{line:51,column:52},end:{line:60,column:1}},line:51},"9":{name:"(anonymous_9)",decl:{start:{line:54,column:14},end:{line:54,column:15}},loc:{start:{line:54,column:25},end:{line:56,column:9}},line:54},"10":{name:"(anonymous_10)",decl:{start:{line:57,column:15},end:{line:57,column:16}},loc:{start:{line:57,column:22},end:{line:59,column:9}},line:57},"11":{name:"(anonymous_11)",decl:{start:{line:63,column:39},end:{line:63,column:40}},loc:{start:{line:63,column:58},end:{line:73,column:1}},line:63},"12":{name:"(anonymous_12)",decl:{start:{line:64,column:41},end:{line:64,column:42}},loc:{start:{line:64,column:64},end:{line:72,column:1}},line:64},"13":{name:"(anonymous_13)",decl:{start:{line:76,column:40},end:{line:76,column:41}},loc:{start:{line:76,column:59},end:{line:95,column:1}},line:76},"14":{name:"(anonymous_14)",decl:{start:{line:77,column:36},end:{line:77,column:37}},loc:{start:{line:77,column:59},end:{line:94,column:5}},line:77},"15":{name:"(anonymous_15)",decl:{start:{line:88,column:32},end:{line:88,column:33}},loc:{start:{line:88,column:43},end:{line:90,column:13}},line:88},"16":{name:"(anonymous_16)",decl:{start:{line:91,column:19},end:{line:91,column:20}},loc:{start:{line:91,column:26},end:{line:93,column:13}},line:91},"17":{name:"(anonymous_17)",decl:{start:{line:98,column:43},end:{line:98,column:44}},loc:{start:{line:98,column:62},end:{line:116,column:1}},line:98},"18":{name:"(anonymous_18)",decl:{start:{line:100,column:36},end:{line:100,column:37}},loc:{start:{line:100,column:59},end:{line:115,column:5}},line:100},"19":{name:"(anonymous_19)",decl:{start:{line:108,column:32},end:{line:108,column:33}},loc:{start:{line:108,column:43},end:{line:110,column:13}},line:108},"20":{name:"(anonymous_20)",decl:{start:{line:111,column:19},end:{line:111,column:20}},loc:{start:{line:111,column:26},end:{line:113,column:13}},line:111},"21":{name:"(anonymous_21)",decl:{start:{line:119,column:41},end:{line:119,column:42}},loc:{start:{line:119,column:60},end:{line:132,column:3}},line:119},"22":{name:"(anonymous_22)",decl:{start:{line:120,column:114},end:{line:120,column:115}},loc:{start:{line:120,column:127},end:{line:131,column:5}},line:120},"23":{name:"(anonymous_23)",decl:{start:{line:135,column:40},end:{line:135,column:41}},loc:{start:{line:135,column:59},end:{line:173,column:1}},line:135},"24":{name:"(anonymous_24)",decl:{start:{line:140,column:61},end:{line:140,column:62}},loc:{start:{line:140,column:84},end:{line:172,column:5}},line:140},"25":{name:"(anonymous_25)",decl:{start:{line:149,column:32},end:{line:149,column:33}},loc:{start:{line:149,column:36},end:{line:149,column:66}},line:149},"26":{name:"(anonymous_26)",decl:{start:{line:164,column:46},end:{line:164,column:47}},loc:{start:{line:164,column:63},end:{line:170,column:13}},line:164},"27":{name:"(anonymous_27)",decl:{start:{line:176,column:52},end:{line:176,column:53}},loc:{start:{line:176,column:71},end:{line:198,column:1}},line:176},"28":{name:"(anonymous_28)",decl:{start:{line:177,column:64},end:{line:177,column:65}},loc:{start:{line:177,column:87},end:{line:197,column:5}},line:177},"29":{name:"(anonymous_29)",decl:{start:{line:185,column:31},end:{line:185,column:32}},loc:{start:{line:185,column:51},end:{line:196,column:15}},line:185},"30":{name:"(anonymous_30)",decl:{start:{line:186,column:47},end:{line:186,column:48}},loc:{start:{line:186,column:67},end:{line:195,column:17}},line:186},"31":{name:"(anonymous_31)",decl:{start:{line:189,column:38},end:{line:189,column:39}},loc:{start:{line:189,column:49},end:{line:191,column:17}},line:189},"32":{name:"(anonymous_32)",decl:{start:{line:192,column:23},end:{line:192,column:24}},loc:{start:{line:192,column:30},end:{line:194,column:17}},line:192}},branchMap:{"0":{loc:{start:{line:21,column:8},end:{line:25,column:9}},type:"if",locations:[{start:{line:21,column:8},end:{line:25,column:9}},{start:{line:21,column:8},end:{line:25,column:9}}],line:21},"1":{loc:{start:{line:65,column:8},end:{line:71,column:9}},type:"if",locations:[{start:{line:65,column:8},end:{line:71,column:9}},{start:{line:65,column:8},end:{line:71,column:9}}],line:65},"2":{loc:{start:{line:78,column:8},end:{line:81,column:59}},type:"if",locations:[{start:{line:78,column:8},end:{line:81,column:59}},{start:{line:78,column:8},end:{line:81,column:59}}],line:78},"3":{loc:{start:{line:101,column:8},end:{line:114,column:9}},type:"if",locations:[{start:{line:101,column:8},end:{line:114,column:9}},{start:{line:101,column:8},end:{line:114,column:9}}],line:101},"4":{loc:{start:{line:122,column:6},end:{line:130,column:7}},type:"if",locations:[{start:{line:122,column:6},end:{line:130,column:7}},{start:{line:122,column:6},end:{line:130,column:7}}],line:122},"5":{loc:{start:{line:142,column:8},end:{line:171,column:9}},type:"if",locations:[{start:{line:142,column:8},end:{line:171,column:9}},{start:{line:142,column:8},end:{line:171,column:9}}],line:142},"6":{loc:{start:{line:165,column:16},end:{line:167,column:17}},type:"if",locations:[{start:{line:165,column:16},end:{line:167,column:17}},{start:{line:165,column:16},end:{line:167,column:17}}],line:165},"7":{loc:{start:{line:178,column:8},end:{line:183,column:120}},type:"if",locations:[{start:{line:178,column:8},end:{line:183,column:120}},{start:{line:178,column:8},end:{line:183,column:120}}],line:178}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"f5dc5425c45d6175a76b328e68a8ca2fb7c49697"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var express=(cov_g99mjt339.s[0]++,require('express'));var traineeRoutes=(cov_g99mjt339.s[1]++,express.Router());const crypto=(cov_g99mjt339.s[2]++,require('crypto'));const nodeMailer=(cov_g99mjt339.s[3]++,require('nodemailer'));const bcrypt=(cov_g99mjt339.s[4]++,require('bcrypt'));var AuthenticationController=(cov_g99mjt339.s[5]++,require('../config/authentication'));var passport=(cov_g99mjt339.s[6]++,require('passport'));var CryptoJS=(cov_g99mjt339.s[7]++,require("crypto-js"));var requireAuth=(cov_g99mjt339.s[8]++,passport.authenticate('jwt',{session:false}));let Trainee=(cov_g99mjt339.s[9]++,require('../models/trainee.model'));cov_g99mjt339.s[10]++;require('dotenv').config();//gets all trainees in database
cov_g99mjt339.s[11]++;traineeRoutes.route('/',requireAuth,AuthenticationController.roleAuthorization(['admin','recruiter','finance'])).get(function(req,res){cov_g99mjt339.f[0]++;cov_g99mjt339.s[12]++;Trainee.find(function(err,trainee){cov_g99mjt339.f[1]++;cov_g99mjt339.s[13]++;if(err){cov_g99mjt339.b[0][0]++;cov_g99mjt339.s[14]++;console.log(err);}else{cov_g99mjt339.b[0][1]++;cov_g99mjt339.s[15]++;res.json(trainee);}});});//get a single trainee by id
cov_g99mjt339.s[16]++;traineeRoutes.route('/:id').get(function(req,res){cov_g99mjt339.f[2]++;let id=(cov_g99mjt339.s[17]++,req.params.id);cov_g99mjt339.s[18]++;Trainee.findById(id,function(err,trainee){cov_g99mjt339.f[3]++;cov_g99mjt339.s[19]++;res.json(trainee);}).catch(err=>{cov_g99mjt339.f[4]++;cov_g99mjt339.s[20]++;console.log(err);cov_g99mjt339.s[21]++;res.status(400).send("Trainee doesn't exist");});});//get a single trainee by email
cov_g99mjt339.s[22]++;traineeRoutes.route('/getByEmail').post(function(req,res){cov_g99mjt339.f[5]++;cov_g99mjt339.s[23]++;Trainee.findOne({trainee_email:req.body.trainee_email},function(err,trainee){cov_g99mjt339.f[6]++;cov_g99mjt339.s[24]++;res.json(trainee);}).catch(err=>{cov_g99mjt339.f[7]++;cov_g99mjt339.s[25]++;res.status(205).send("Trainee doesn't exist");});});//adds new trainee to database
cov_g99mjt339.s[26]++;traineeRoutes.route('/add').post(function(req,res){cov_g99mjt339.f[8]++;let trainee=(cov_g99mjt339.s[27]++,new Trainee(req.body));cov_g99mjt339.s[28]++;trainee.save().then(trainee=>{cov_g99mjt339.f[9]++;cov_g99mjt339.s[29]++;res.status(200).json({'trainee':'Trainee added successfully'});}).catch(err=>{cov_g99mjt339.f[10]++;cov_g99mjt339.s[30]++;res.status(205).send('Adding new trainee failed');});});//deletes a trainee by id
cov_g99mjt339.s[31]++;traineeRoutes.route('/delete/:id').get(function(req,res){cov_g99mjt339.f[11]++;cov_g99mjt339.s[32]++;Trainee.remove({_id:req.params.id},function(err,trainee){cov_g99mjt339.f[12]++;cov_g99mjt339.s[33]++;if(!err){cov_g99mjt339.b[1][0]++;cov_g99mjt339.s[34]++;res.json({'result':true});}else{cov_g99mjt339.b[1][1]++;cov_g99mjt339.s[35]++;console.log(err);cov_g99mjt339.s[36]++;res.json({'result':false});}});});//gets trainee by id and updates values of that trainee
cov_g99mjt339.s[37]++;traineeRoutes.route('/update/:id').post(function(req,res){cov_g99mjt339.f[13]++;cov_g99mjt339.s[38]++;Trainee.findById(req.params.id,function(err,trainee){cov_g99mjt339.f[14]++;cov_g99mjt339.s[39]++;if(!trainee){cov_g99mjt339.b[2][0]++;cov_g99mjt339.s[40]++;res.status(404).send("data is not found");}else{cov_g99mjt339.b[2][1]++;cov_g99mjt339.s[41]++;trainee.trainee_fname=req.body.trainee_fname;}cov_g99mjt339.s[42]++;trainee.trainee_lname=req.body.trainee_lname;cov_g99mjt339.s[43]++;trainee.trainee_email=req.body.trainee_email;cov_g99mjt339.s[44]++;trainee.trainee_bank_name=req.body.trainee_bank_name;cov_g99mjt339.s[45]++;trainee.trainee_account_no=req.body.trainee_account_no;cov_g99mjt339.s[46]++;trainee.trainee_sort_code=req.body.trainee_sort_code;cov_g99mjt339.s[47]++;trainee.save().then(trainee=>{cov_g99mjt339.f[15]++;cov_g99mjt339.s[48]++;res.json('Trainee updated!');}).catch(err=>{cov_g99mjt339.f[16]++;cov_g99mjt339.s[49]++;res.status(400).send("Update not possible");});});});//gets trainee by id and updates start/end date
cov_g99mjt339.s[50]++;traineeRoutes.route('/editDates/:id').post(function(req,res){cov_g99mjt339.f[17]++;cov_g99mjt339.s[51]++;console.log(req);cov_g99mjt339.s[52]++;Trainee.findById(req.params.id,function(err,trainee){cov_g99mjt339.f[18]++;cov_g99mjt339.s[53]++;if(!trainee){cov_g99mjt339.b[3][0]++;cov_g99mjt339.s[54]++;res.status(404).send("data is not found");}else{cov_g99mjt339.b[3][1]++;cov_g99mjt339.s[55]++;trainee.trainee_start_date=req.body.trainee_start_date;cov_g99mjt339.s[56]++;trainee.trainee_end_date=req.body.trainee_end_date;cov_g99mjt339.s[57]++;trainee.save().then(trainee=>{cov_g99mjt339.f[19]++;cov_g99mjt339.s[58]++;res.json('Trainee updated!');}).catch(err=>{cov_g99mjt339.f[20]++;cov_g99mjt339.s[59]++;res.status(400).send("Update not possible");});}});});//checks if trainee password reset token is valid
cov_g99mjt339.s[60]++;traineeRoutes.route('/reset/:token').get(function(req,res){cov_g99mjt339.f[21]++;cov_g99mjt339.s[61]++;Trainee.findOne({trainee_password_token:req.params.token,trainee_password_expires:{$gt:Date.now()}}).then(trainee=>{cov_g99mjt339.f[22]++;cov_g99mjt339.s[62]++;console.log(Date.now());cov_g99mjt339.s[63]++;if(trainee==null){cov_g99mjt339.b[4][0]++;cov_g99mjt339.s[64]++;console.error('password reset link is invalid or has expired');cov_g99mjt339.s[65]++;res.status(403).send('password reset link is invalid or has expired');}else{cov_g99mjt339.b[4][1]++;cov_g99mjt339.s[66]++;res.status(200).send({trainee_id:trainee._id,message:'password reset link a-ok'});}});});//sends trainee password reset email
cov_g99mjt339.s[67]++;traineeRoutes.route('/send-email').post(function(req,res){cov_g99mjt339.f[23]++;var key=(cov_g99mjt339.s[68]++,CryptoJS.enc.Hex.parse("253D3FB468A0E24677C28A624BE0F939"));var iv=(cov_g99mjt339.s[69]++,CryptoJS.enc.Hex.parse("00000000000000000000000000000000"));var email=(cov_g99mjt339.s[70]++,CryptoJS.AES.decrypt(req.body.trainee_email,key,{iv:iv}));cov_g99mjt339.s[71]++;console.log("got email:"+email.toString(CryptoJS.enc.Utf8));cov_g99mjt339.s[72]++;Trainee.findOne({trainee_email:req.body.trainee_email},function(err,trainee){cov_g99mjt339.f[24]++;cov_g99mjt339.s[73]++;console.log(trainee);cov_g99mjt339.s[74]++;if(!trainee){cov_g99mjt339.b[5][0]++;cov_g99mjt339.s[75]++;res.status(404).send("Email is not found");}else{cov_g99mjt339.b[5][1]++;const token=(cov_g99mjt339.s[76]++,crypto.randomBytes(20).toString('hex'));cov_g99mjt339.s[77]++;trainee.trainee_password_token=token;cov_g99mjt339.s[78]++;trainee.trainee_password_expires=Date.now()+3600000;cov_g99mjt339.s[79]++;trainee.save().then(()=>{cov_g99mjt339.f[25]++;cov_g99mjt339.s[80]++;return console.log('token generated');});var transporter=(cov_g99mjt339.s[81]++,nodeMailer.createTransport({service:'AOL',auth:{user:'QABursary@aol.com',pass:'Passw0rd123'}}));var mailOptions=(cov_g99mjt339.s[82]++,{from:'QABursary@aol.com',// sender address
to:email.toString(CryptoJS.enc.Utf8),// list of receivers
subject:'Password Reset',// Subject line
text:'Please navigate to the following link to activate your QA bursary account and set your password: http://'+process.env.REACT_APP_AWS_IP+':3000/changePassword/'+token// plain text body
});cov_g99mjt339.s[83]++;transporter.sendMail(mailOptions,(error,info)=>{cov_g99mjt339.f[26]++;cov_g99mjt339.s[84]++;if(error){cov_g99mjt339.b[6][0]++;cov_g99mjt339.s[85]++;return console.log(error);}else{cov_g99mjt339.b[6][1]++;}cov_g99mjt339.s[86]++;console.log('Message %s sent: %s',info.messageId,info.response);cov_g99mjt339.s[87]++;res.status(200).json({'email':'Email Sent'});});}});});//updates trainee password
cov_g99mjt339.s[88]++;traineeRoutes.route('/update-password/:token').post(function(req,res){cov_g99mjt339.f[27]++;cov_g99mjt339.s[89]++;Trainee.findOne({trainee_password_token:req.params.token},function(err,trainee){cov_g99mjt339.f[28]++;cov_g99mjt339.s[90]++;if(!trainee){cov_g99mjt339.b[7][0]++;cov_g99mjt339.s[91]++;res.status(404).send("data is not found");}else//bcrypt pass
//var bytes  = CryptoJS.AES.decrypt(req.body.trainee_password, '3FJSei8zPx');
{cov_g99mjt339.b[7][1]++;var decryptPass=(cov_g99mjt339.s[92]++,CryptoJS.AES.decrypt(req.body.trainee_password,'3FJSei8zPx').toString(CryptoJS.enc.Utf8));}cov_g99mjt339.s[93]++;bcrypt.genSalt(10,function(err,salt){cov_g99mjt339.f[29]++;cov_g99mjt339.s[94]++;bcrypt.hash(decryptPass,salt,function(err,hash){cov_g99mjt339.f[30]++;cov_g99mjt339.s[95]++;req.body.trainee_password=hash;cov_g99mjt339.s[96]++;trainee.trainee_password=req.body.trainee_password;cov_g99mjt339.s[97]++;trainee.save().then(trainee=>{cov_g99mjt339.f[31]++;cov_g99mjt339.s[98]++;res.json('Password updated!');}).catch(err=>{cov_g99mjt339.f[32]++;cov_g99mjt339.s[99]++;res.status(400).send("Update not possible");});});});});});cov_g99mjt339.s[100]++;module.exports=traineeRoutes;