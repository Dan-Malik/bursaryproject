{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\src\\\\components\\\\exportDates..component.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport CryptoJS from \"react-native-crypto-js\";\nimport { codes } from \"../secrets/secrets.js\";\nimport AccessDenied from './modules/AccessDenied';\nimport { authService } from './modules/authService';\nimport '../css/list-trainee-recruiter.css';\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { CSVLink } from \"react-csv\";\nimport moment from 'moment';\nimport DayPicker, { DateUtils } from 'react-day-picker';\nimport 'react-day-picker/lib/style.css';\nimport { Modal, ModalHeader, ModalBody } from 'reactstrap';\n\nvar ListTrainee =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ListTrainee, _Component);\n\n  function ListTrainee(props) {\n    var _this;\n\n    _classCallCheck(this, ListTrainee);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ListTrainee).call(this, props));\n\n    _this.onChangeSearch = function (e) {\n      _this.setState({\n        searchString: e,\n        selectedDate: e\n      });\n    };\n\n    _this.state = {\n      trainees: [],\n      selectedDays: [],\n      splitDays: [],\n      currentUser: authService.currentUserValue,\n      csv: '',\n      modal: false\n    }; //Added onChangeSearch - Ernie\n\n    _this.onChangeSearch = _this.onChangeSearch.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleDayClick = _this.handleDayClick.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.toggle = _this.toggle.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(ListTrainee, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      axios.get('http://' + process.env.REACT_APP_AWS_IP + ':4000/trainee/').then(function (response) {\n        var encrypted = response.data;\n        encrypted.map(function (currentTrainee, i) {\n          var bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_email, codes.staff, {\n            iv: codes.iv\n          });\n          currentTrainee.trainee_email = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_fname, codes.trainee);\n          currentTrainee.trainee_fname = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_lname, codes.trainee);\n          currentTrainee.trainee_lname = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_start_date, codes.trainee);\n          currentTrainee.trainee_start_date = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_end_date, codes.trainee);\n          currentTrainee.trainee_end_date = bytes.toString(CryptoJS.enc.Utf8);\n\n          if (currentTrainee.trainee_bank_name != undefined && currentTrainee.trainee_account_no != undefined && currentTrainee.trainee_sort_code != undefined) {\n            console.log(currentTrainee.trainee_fname);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_bank_name, codes.trainee);\n            currentTrainee.trainee_bank_name = bytes.toString(CryptoJS.enc.Utf8);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_account_no, codes.trainee);\n            currentTrainee.trainee_account_no = bytes.toString(CryptoJS.enc.Utf8);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_sort_code, codes.trainee);\n            currentTrainee.trainee_sort_code = bytes.toString(CryptoJS.enc.Utf8);\n          }\n        });\n\n        _this2.setState({\n          trainees: encrypted\n        });\n      }).catch(function (error) {\n        console.log(error);\n      });\n    } // Added onChangeSearch(e) function. Needed for the search filter\n\n  }, {\n    key: \"toggle\",\n    value: function toggle() {\n      this.setState(function (prevState) {\n        return {\n          modal: !prevState.modal\n        };\n      });\n    }\n  }, {\n    key: \"handleDayClick\",\n    value: function handleDayClick(day, _ref) {\n      var selected = _ref.selected;\n      var selectedDays = this.state.selectedDays;\n      var splitDays = this.state.splitDays;\n\n      if (selected) {\n        var selectedIndex = selectedDays.findIndex(function (selectedDay) {\n          return DateUtils.isSameDay(selectedDay, day);\n        });\n        selectedDays.splice(selectedIndex, 1);\n        splitDays.splice(selectedIndex, 1);\n      } else {\n        selectedDays.push(day);\n        splitDays.push(day.toString().split(\" \", 4).toString());\n      }\n\n      this.setState({\n        selectedDays: selectedDays\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      //Declared variables in order to read input from search function\n      var trainees = this.state.trainees;\n      var search = this.state.selectedDays;\n      var splitDays = this.state.splitDays;\n      var output = this.state.csv;\n      var role = this.state.currentUser.token.role;\n\n      if (role === 'finance') {\n        output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\", \"Start-Date\", \"End-Date\"]];\n        trainees.map(function (t) {\n          var obj = [t.trainee_fname, t.trainee_lname, t.trainee_email, t.trainee_bank_name, t.trainee_account_no, t.trainee_sort_code, moment(t.trainee_start_date).format('MMMM Do YYYY'), moment(t.trainee_end_date).format('MMMM Do YYYY')];\n          output.push(obj);\n        });\n      } else if (role === 'admin') {\n        output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\n        trainees.map(function (t) {\n          var obj = [t.trainee_fname, t.trainee_lname, t.trainee_email, moment(t.trainee_start_date).format('MMMM Do YYYY'), moment(t.trainee_end_date).format('MMMM Do YYYY')];\n          output.push(obj);\n        });\n      }\n\n      console.log(search.length);\n\n      if (search.length > 0) {\n        if (role === 'finance') {\n          output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\", \"Start-Date\", \"End-Date\"]];\n        } else if (role === 'admin') {\n          output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\n        }\n\n        console.log(search);\n        console.log(this.state.splitDays);\n        trainees = trainees.filter(function (i) {\n          if (splitDays.includes(i.trainee_start_date.split(\" \", 4).toString())) {\n            if (role === 'finance') {\n              var obj = [i.trainee_fname, i.trainee_lname, i.trainee_email, i.trainee_bank_name, i.trainee_account_no, i.trainee_sort_code, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\n              output.push(obj);\n              console.log(output);\n              return i;\n            } else if (role === 'admin') {\n              var obj = [i.trainee_fname, i.trainee_lname, i.trainee_email, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\n              output.push(obj);\n              console.log(output);\n              return i;\n            }\n          }\n        });\n      }\n\n      if (this.state.currentUser.token.role === 'finance' || this.state.currentUser.token.role === 'admin') {\n        var _React$createElement;\n\n        return React.createElement(\"div\", {\n          className: \"QAtable\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"QASearchBar\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, React.createElement(Modal, (_React$createElement = {\n          isOpen: this.state.modal,\n          toggle: this.toggle,\n          className: this.props.className\n        }, _defineProperty(_React$createElement, \"className\", \"dateModal\"), _defineProperty(_React$createElement, \"__source\", {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        }), _defineProperty(_React$createElement, \"__self\", this), _React$createElement), React.createElement(ModalHeader, {\n          toggle: this.toggle,\n          cssModule: {\n            'modal-title': 'w-100 text-center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162\n          },\n          __self: this\n        }, \"Select Start Dates\"), React.createElement(ModalBody, {\n          cssModule: {\n            'modal-body': 'w-100 text-center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163\n          },\n          __self: this\n        }, React.createElement(DayPicker, {\n          selectedDays: this.state.selectedDays,\n          onDayClick: this.handleDayClick,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 164\n          },\n          __self: this\n        }))), React.createElement(\"div\", {\n          id: \"addUser\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 170\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: \"qabtn\",\n          onClick: this.toggle,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171\n          },\n          __self: this\n        }, \"Select Dates\"), React.createElement(\"button\", {\n          className: \"qabtn\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, React.createElement(CSVLink, {\n          className: \"link\",\n          data: output,\n          filename: \"CSV-Report.csv\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, \"Download CSV \")))), React.createElement(\"table\", {\n          className: \"table table-striped\",\n          style: {\n            marginTop: 20\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        }, React.createElement(\"thead\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        }, React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179\n          },\n          __self: this\n        }, \"First Name\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        }, \"Last Name\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }, \"Email\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }, \"Start Date\"))), React.createElement(\"tbody\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185\n          },\n          __self: this\n        }, trainees.map(function (t) {\n          return React.createElement(\"tr\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 188\n            },\n            __self: this\n          }, React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 189\n            },\n            __self: this\n          }, \" \", t.trainee_fname), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 190\n            },\n            __self: this\n          }, \" \", t.trainee_lname), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 191\n            },\n            __self: this\n          }, \" \", t.trainee_email), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 192\n            },\n            __self: this\n          }, \" \", moment(t.trainee_start_date).format('MMMM Do YYYY')));\n        }))));\n      } else {\n        return React.createElement(AccessDenied, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 204\n          },\n          __self: this\n        });\n      }\n    }\n  }]);\n\n  return ListTrainee;\n}(Component);\n\nexport { ListTrainee as default };","map":{"version":3,"sources":["C:\\Users\\Chi Zhang\\Desktop\\QA Bursary project\\AWS-Bursary-Project-V1\\React\\src\\components\\exportDates..component.js"],"names":["React","Component","axios","CryptoJS","codes","AccessDenied","authService","CSVLink","moment","DayPicker","DateUtils","Modal","ModalHeader","ModalBody","ListTrainee","props","onChangeSearch","e","setState","searchString","selectedDate","state","trainees","selectedDays","splitDays","currentUser","currentUserValue","csv","modal","bind","handleDayClick","toggle","get","process","env","REACT_APP_AWS_IP","then","response","encrypted","data","map","currentTrainee","i","bytes","AES","decrypt","trainee_email","staff","iv","toString","enc","Utf8","trainee_fname","trainee","trainee_lname","trainee_start_date","trainee_end_date","trainee_bank_name","undefined","trainee_account_no","trainee_sort_code","console","log","catch","error","prevState","day","selected","selectedIndex","findIndex","selectedDay","isSameDay","splice","push","split","search","output","role","token","t","obj","format","length","filter","includes","className","marginTop"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\n\r\nimport axios from 'axios';\r\nimport CryptoJS from \"react-native-crypto-js\";\r\nimport { codes } from \"../secrets/secrets.js\";\r\nimport AccessDenied from './modules/AccessDenied';\r\nimport { authService } from './modules/authService';\r\nimport '../css/list-trainee-recruiter.css';\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\nimport { CSVLink } from \"react-csv\";\r\nimport moment from 'moment';\r\n\r\nimport DayPicker, { DateUtils } from 'react-day-picker';\r\nimport 'react-day-picker/lib/style.css';\r\nimport { Modal, ModalHeader, ModalBody } from 'reactstrap';\r\n\r\nexport default class ListTrainee extends Component {\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n\t\t\t\r\n        this.state = {\r\n\t\t\ttrainees: [], \r\n            selectedDays: [],\r\n            splitDays:[],\r\n            currentUser: authService.currentUserValue,\r\n            csv: '',\r\n            modal: false\r\n\t\t\t};\r\n        \r\n       //Added onChangeSearch - Ernie\r\n        this.onChangeSearch = this.onChangeSearch.bind(this);\r\n        this.handleDayClick = this.handleDayClick.bind(this);\r\n        this.toggle = this.toggle.bind(this);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        axios.get('http://'+process.env.REACT_APP_AWS_IP+':4000/trainee/')\r\n            .then(response => {\r\n                var encrypted = response.data;\r\n                encrypted.map(function(currentTrainee, i){\r\n                    var bytes  = CryptoJS.AES.decrypt(currentTrainee.trainee_email, codes.staff, {iv: codes.iv});\r\n                    currentTrainee.trainee_email = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_fname, codes.trainee);\r\n                    currentTrainee.trainee_fname = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_lname, codes.trainee);\r\n                    currentTrainee.trainee_lname = bytes.toString(CryptoJS.enc.Utf8);\r\n\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_start_date, codes.trainee);\r\n                    currentTrainee.trainee_start_date = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_end_date, codes.trainee);\r\n                    currentTrainee.trainee_end_date = bytes.toString((CryptoJS.enc.Utf8));\r\n                    \r\n                    if(currentTrainee.trainee_bank_name != undefined && currentTrainee.trainee_account_no != undefined && currentTrainee.trainee_sort_code != undefined){\r\n                        console.log(currentTrainee.trainee_fname);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_bank_name, codes.trainee);\r\n                        currentTrainee.trainee_bank_name = bytes.toString(CryptoJS.enc.Utf8);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_account_no, codes.trainee);\r\n                        currentTrainee.trainee_account_no = bytes.toString(CryptoJS.enc.Utf8);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_sort_code, codes.trainee);\r\n                        currentTrainee.trainee_sort_code = bytes.toString(CryptoJS.enc.Utf8);\r\n                    }\r\n                });\r\n                this.setState({trainees: encrypted});\r\n            })\r\n            .catch(function (error){\r\n                console.log(error);\r\n            })\r\n    }\r\n\r\n    // Added onChangeSearch(e) function. Needed for the search filter\r\n    onChangeSearch= (e) =>{\r\n            this.setState({\r\n                searchString: e,\r\n                selectedDate: e\r\n            });\r\n    }\r\n    toggle() {\r\n        this.setState(prevState => ({\r\n          modal: !prevState.modal\r\n        }));\r\n      }\r\n\r\n    handleDayClick(day, { selected }) {\r\n        const { selectedDays } = this.state;\r\n        const { splitDays } = this.state;\r\n        if (selected) {\r\n          const selectedIndex = selectedDays.findIndex(selectedDay =>\r\n            DateUtils.isSameDay(selectedDay, day)\r\n          );\r\n        selectedDays.splice(selectedIndex, 1);\r\n        splitDays.splice(selectedIndex, 1);\r\n        } else {\r\n          selectedDays.push(day);\r\n           splitDays.push(day.toString().split(\" \", 4).toString());\r\n        }\r\n        this.setState({ selectedDays });\r\n      }\r\n\t\r\n    render() {\r\n        //Declared variables in order to read input from search function\r\n        let trainees = this.state.trainees;\r\n        let search = this.state.selectedDays;\r\n        let splitDays = this.state.splitDays;\r\n        let output = this.state.csv;\r\n        let role = this.state.currentUser.token.role\r\n        if(role === 'finance'){\r\n            output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\",\"Start-Date\", \"End-Date\"]];\r\n            trainees.map( t => {\r\n                    var obj = [t.trainee_fname, t.trainee_lname, t.trainee_email, t.trainee_bank_name, t.trainee_account_no, t.trainee_sort_code, moment(t.trainee_start_date).format('MMMM Do YYYY'), moment(t.trainee_end_date).format('MMMM Do YYYY')];\r\n                    output.push(obj);\r\n                }\r\n            )\r\n        }else if(role === 'admin'){\r\n            output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\r\n            trainees.map( t => {\r\n                    var obj = [t.trainee_fname, t.trainee_lname, t.trainee_email, moment(t.trainee_start_date).format('MMMM Do YYYY'), moment(t.trainee_end_date).format('MMMM Do YYYY')];\r\n                    output.push(obj);\r\n                }\r\n            )\r\n        }\r\n        \r\n        console.log(search.length);\r\n        if(search.length > 0){\r\n            if(role === 'finance'){\r\n                 output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\",\"Start-Date\", \"End-Date\"]];\r\n            }\r\n            else if(role === 'admin'){\r\n                 output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\r\n            }\r\n            console.log(search);\r\n            console.log(this.state.splitDays);\r\n            trainees = trainees.filter(function(i){\r\n                if(splitDays.includes(i.trainee_start_date.split(\" \", 4).toString())){\r\n                    if(role === 'finance'){\r\n                        var obj =  [i.trainee_fname, i.trainee_lname, i.trainee_email, i.trainee_bank_name, i.trainee_account_no, i.trainee_sort_code, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\r\n                        output.push(obj);\r\n                        console.log(output);\r\n                        return i;\r\n                    } else if(role === 'admin'){\r\n                        var obj =  [i.trainee_fname, i.trainee_lname, i.trainee_email, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\r\n                        output.push(obj);\r\n                        console.log(output);\r\n                        return i;\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        if(this.state.currentUser.token.role === 'finance' || this.state.currentUser.token.role === 'admin'){\r\n        return (\r\n            <div className=\"QAtable\">\r\n                <div className=\"QASearchBar\">\r\n                    {/* <DatePicker\r\n                        selected={this.state.selectedDate}\r\n                        onChange={this.onChangeSearch}\r\n                        dateFormat=\"dd/MM/yyyy\"\r\n                        placeholderText=\"Specify Start Date to filter\"\r\n                        strictParsing\r\n                        disabledKeyboardNavigation\r\n                    /> */}\r\n                    <Modal isOpen={this.state.modal} toggle={this.toggle} className={this.props.className} className=\"dateModal\">\r\n                        <ModalHeader toggle={this.toggle} cssModule={{'modal-title':'w-100 text-center'}}>Select Start Dates</ModalHeader>\r\n                        <ModalBody cssModule={{'modal-body':'w-100 text-center'}}>\r\n                            <DayPicker\r\n                                selectedDays={this.state.selectedDays}\r\n                                onDayClick={this.handleDayClick}\r\n                            />\r\n                        </ModalBody>\r\n                    </Modal>\r\n                    <div id=\"addUser\">\r\n                        <button className=\"qabtn\" onClick={this.toggle}>Select Dates</button>\r\n                        <button className=\"qabtn\"><CSVLink className=\"link\" data={output} filename='CSV-Report.csv'>Download CSV </CSVLink></button>\r\n                    </div>\r\n                </div>\r\n\r\n                <table className=\"table table-striped\" style={{ marginTop: 20 }} >\r\n                    <thead>\r\n                        <tr>\r\n                            <th>First Name</th>\r\n                            <th>Last Name</th>\r\n                            <th>Email</th>\r\n                            <th>Start Date</th>\r\n                        </tr>\r\n                    </thead>               \r\n                    <tbody>\r\n                        {trainees.map(t => {\r\n                            return (\r\n                                <tr>\r\n                                    <td> {t.trainee_fname}</td>\r\n                                    <td> {t.trainee_lname}</td>\r\n                                    <td> {t.trainee_email}</td>\r\n                                    <td> {moment(t.trainee_start_date).format('MMMM Do YYYY')}</td>\r\n                                </tr>\r\n                            );\r\n                        })}\r\n                    </tbody>\r\n\r\n                </table>\r\n            </div>\r\n        );\r\n        }\r\n        else{\r\n\t\t\treturn (\r\n\t\t\t<AccessDenied/>\r\n\t\t\t)\r\n        }\r\n\t}\r\n}"]},"metadata":{},"sourceType":"module"}