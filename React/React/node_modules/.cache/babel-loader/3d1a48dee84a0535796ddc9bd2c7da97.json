{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\src\\\\components\\\\exportDates..component.js\";\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport axios from 'axios';\nimport CryptoJS from \"react-native-crypto-js\";\nimport { codes } from \"../secrets/secrets.js\";\nimport AccessDenied from './modules/AccessDenied';\nimport { authService } from './modules/authService';\nimport '../css/list-trainee-recruiter.css';\nimport DatePicker from 'react-datepicker';\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { CSVLink } from \"react-csv\";\nimport moment from 'moment';\n\nvar ListTrainee =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ListTrainee, _Component);\n\n  function ListTrainee(props) {\n    var _this;\n\n    _classCallCheck(this, ListTrainee);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ListTrainee).call(this, props));\n\n    _this.onChangeSearch = function (e) {\n      var dateString = moment(e).format('DD/MM/YY').toString();\n\n      if (dateString.length == 8) {\n        _this.setState({\n          searchString: e.toString(),\n          selectedDate: e\n        });\n      }\n    };\n\n    _this.state = {\n      trainees: [],\n      searchString: \"\",\n      currentUser: authService.currentUserValue,\n      selectedDate: '',\n      csv: ''\n    }; //Added onChangeSearch - Ernie\n\n    _this.onChangeSearch = _this.onChangeSearch.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(ListTrainee, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      axios.get('http://' + process.env.REACT_APP_AWS_IP + ':4000/trainee/').then(function (response) {\n        var encrypted = response.data;\n        encrypted.map(function (currentTrainee, i) {\n          var bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_email, codes.staff, {\n            iv: codes.iv\n          });\n          currentTrainee.trainee_email = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_fname, codes.trainee);\n          currentTrainee.trainee_fname = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_lname, codes.trainee);\n          currentTrainee.trainee_lname = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_start_date, codes.trainee);\n          currentTrainee.trainee_start_date = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_end_date, codes.trainee);\n          currentTrainee.trainee_end_date = bytes.toString(CryptoJS.enc.Utf8);\n\n          if (currentTrainee.trainee_bank_name != undefined && currentTrainee.trainee_account_no != undefined && currentTrainee.trainee_sort_code != undefined) {\n            console.log(currentTrainee.trainee_fname);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_bank_name, codes.trainee);\n            currentTrainee.trainee_bank_name = bytes.toString(CryptoJS.enc.Utf8);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_account_no, codes.trainee);\n            currentTrainee.trainee_account_no = bytes.toString(CryptoJS.enc.Utf8);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_sort_code, codes.trainee);\n            currentTrainee.trainee_sort_code = bytes.toString(CryptoJS.enc.Utf8);\n          }\n        });\n\n        _this2.setState({\n          trainees: encrypted\n        });\n      }).catch(function (error) {\n        console.log(error);\n      });\n    } // Added onChangeSearch(e) function. Needed for the search filter\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      //Declared variables in order to read input from search function\n      var trainees = this.state.trainees;\n      var search = this.state.searchString;\n      var output = this.state.csv;\n      var role = this.state.currentUser.token.role;\n\n      if (role === 'finance') {\n        output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\", \"Start-Date\", \"End-Date\"]];\n      } else {\n        output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\n      }\n\n      console.log(this.state.searchString);\n\n      if (search.length > 0) {\n        trainees = trainees.filter(function (i) {\n          if (i.trainee_start_date.split(\" \", 4).toString() === search.split(\" \", 4).toString()) {\n            if (role === 'finance') {\n              var obj = [i.trainee_fname, i.trainee_lname, i.trainee_email, i.trainee_bank_name, i.trainee_account_no, i.trainee_sort_code, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\n              output.push(obj);\n              console.log(output);\n              return i;\n            } else if (role === 'admin') {\n              var obj = [i.trainee_fname, i.trainee_lname, i.trainee_email, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\n              output.push(obj);\n              console.log(output);\n              return i;\n            }\n          }\n        });\n      }\n\n      if (this.state.currentUser.token.role === 'finance' || this.state.currentUser.token.role === 'admin') {\n        return React.createElement(\"div\", {\n          className: \"QAtable\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 109\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"QASearchBar\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 110\n          },\n          __self: this\n        }, React.createElement(DatePicker, {\n          selected: this.state.selectedDate,\n          onChange: this.onChangeSearch,\n          dateFormat: \"dd/MM/yyyy\",\n          placeholderText: \"Specify Start Date to filter\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 111\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          id: \"addUser\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: \"qabtn\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118\n          },\n          __self: this\n        }, React.createElement(CSVLink, {\n          className: \"link\",\n          data: output,\n          filename: \"monthly-intake.csv\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118\n          },\n          __self: this\n        }, \"Download CSV \")))), React.createElement(\"table\", {\n          className: \"table table-striped\",\n          style: {\n            marginTop: 20\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 122\n          },\n          __self: this\n        }, React.createElement(\"thead\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 123\n          },\n          __self: this\n        }, React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 124\n          },\n          __self: this\n        }, React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 125\n          },\n          __self: this\n        }, \"First Name\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 126\n          },\n          __self: this\n        }, \"Last Name\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 127\n          },\n          __self: this\n        }, \"Email\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 128\n          },\n          __self: this\n        }, \"Start Date\"))), React.createElement(\"tbody\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131\n          },\n          __self: this\n        }, trainees.map(function (t) {\n          return React.createElement(\"tr\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134\n            },\n            __self: this\n          }, React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 135\n            },\n            __self: this\n          }, \" \", t.trainee_fname), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 136\n            },\n            __self: this\n          }, \" \", t.trainee_lname), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 137\n            },\n            __self: this\n          }, \" \", t.trainee_email), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 138\n            },\n            __self: this\n          }, \" \", moment(t.trainee_start_date).format('MMMM Do YYYY')));\n        }))));\n      } else {\n        return React.createElement(AccessDenied, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150\n          },\n          __self: this\n        });\n      }\n    }\n  }]);\n\n  return ListTrainee;\n}(Component);\n\nexport { ListTrainee as default };","map":{"version":3,"sources":["C:\\Users\\Chi Zhang\\Desktop\\QA Bursary project\\AWS-Bursary-Project-V1\\React\\src\\components\\exportDates..component.js"],"names":["React","Component","Link","axios","CryptoJS","codes","AccessDenied","authService","DatePicker","CSVLink","moment","ListTrainee","props","onChangeSearch","e","dateString","format","toString","length","setState","searchString","selectedDate","state","trainees","currentUser","currentUserValue","csv","bind","get","process","env","REACT_APP_AWS_IP","then","response","encrypted","data","map","currentTrainee","i","bytes","AES","decrypt","trainee_email","staff","iv","enc","Utf8","trainee_fname","trainee","trainee_lname","trainee_start_date","trainee_end_date","trainee_bank_name","undefined","trainee_account_no","trainee_sort_code","console","log","catch","error","search","output","role","token","filter","split","obj","push","marginTop","t"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport CryptoJS from \"react-native-crypto-js\";\r\nimport { codes } from \"../secrets/secrets.js\";\r\nimport AccessDenied from './modules/AccessDenied';\r\nimport { authService } from './modules/authService';\r\nimport '../css/list-trainee-recruiter.css';\r\nimport DatePicker from 'react-datepicker';\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\nimport { CSVLink } from \"react-csv\";\r\nimport moment from 'moment';\r\n\r\nexport default class ListTrainee extends Component {\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n\t\t\t\r\n        this.state = {\r\n\t\t\ttrainees: [], \r\n\t\t\tsearchString: \"\",\r\n            currentUser: authService.currentUserValue,\r\n            selectedDate: '',\r\n            csv: ''\r\n\t\t\t};\r\n        \r\n       //Added onChangeSearch - Ernie\r\n        this.onChangeSearch = this.onChangeSearch.bind(this);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        axios.get('http://'+process.env.REACT_APP_AWS_IP+':4000/trainee/')\r\n            .then(response => {\r\n                var encrypted = response.data;\r\n                encrypted.map(function(currentTrainee, i){\r\n                    var bytes  = CryptoJS.AES.decrypt(currentTrainee.trainee_email, codes.staff, {iv: codes.iv});\r\n                    currentTrainee.trainee_email = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_fname, codes.trainee);\r\n                    currentTrainee.trainee_fname = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_lname, codes.trainee);\r\n                    currentTrainee.trainee_lname = bytes.toString(CryptoJS.enc.Utf8);\r\n\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_start_date, codes.trainee);\r\n                    currentTrainee.trainee_start_date = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_end_date, codes.trainee);\r\n                    currentTrainee.trainee_end_date = bytes.toString((CryptoJS.enc.Utf8));\r\n                    \r\n                    if(currentTrainee.trainee_bank_name != undefined && currentTrainee.trainee_account_no != undefined && currentTrainee.trainee_sort_code != undefined){\r\n                        console.log(currentTrainee.trainee_fname);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_bank_name, codes.trainee);\r\n                        currentTrainee.trainee_bank_name = bytes.toString(CryptoJS.enc.Utf8);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_account_no, codes.trainee);\r\n                        currentTrainee.trainee_account_no = bytes.toString(CryptoJS.enc.Utf8);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_sort_code, codes.trainee);\r\n                        currentTrainee.trainee_sort_code = bytes.toString(CryptoJS.enc.Utf8);\r\n                    }\r\n                });\r\n                this.setState({trainees: encrypted});\r\n            })\r\n            .catch(function (error){\r\n                console.log(error);\r\n            })\r\n    }\r\n\r\n    // Added onChangeSearch(e) function. Needed for the search filter\r\n    onChangeSearch= (e) =>{\r\n        var dateString = moment(e).format('DD/MM/YY').toString()\r\n        if(dateString.length == 8){\r\n            this.setState({\r\n                searchString: e.toString(),\r\n                selectedDate: e\r\n            });\r\n        }\r\n    }\r\n\t\r\n    render() {\r\n        //Declared variables in order to read input from search function\r\n        let trainees = this.state.trainees;\r\n        let search = this.state.searchString;\r\n        let output = this.state.csv;\r\n        let role = this.state.currentUser.token.role\r\n        if(role === 'finance'){\r\n            output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\",\"Start-Date\", \"End-Date\"]];\r\n        }else{\r\n            output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\r\n        }\r\n        \r\n        console.log(this.state.searchString);\r\n        \r\n        if(search.length > 0){\r\n            trainees = trainees.filter(function(i){\r\n                if(i.trainee_start_date.split(\" \", 4).toString() === search.split(\" \", 4).toString()){\r\n                    if(role === 'finance'){\r\n                        var obj =  [i.trainee_fname, i.trainee_lname, i.trainee_email, i.trainee_bank_name, i.trainee_account_no, i.trainee_sort_code, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\r\n                        output.push(obj);\r\n                        console.log(output);\r\n                        return i;\r\n                    } else if(role === 'admin'){\r\n                        var obj =  [i.trainee_fname, i.trainee_lname, i.trainee_email, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\r\n                        output.push(obj);\r\n                        console.log(output);\r\n                        return i;\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        if(this.state.currentUser.token.role === 'finance' || this.state.currentUser.token.role === 'admin'){\r\n        return (\r\n            <div className=\"QAtable\">\r\n                <div className=\"QASearchBar\">\r\n                    <DatePicker\r\n                        selected={this.state.selectedDate}\r\n                        onChange={this.onChangeSearch}\r\n                        dateFormat=\"dd/MM/yyyy\"\r\n                        placeholderText=\"Specify Start Date to filter\"\r\n                    />\r\n                    <div id=\"addUser\">\r\n                        <button className=\"qabtn\"><CSVLink className=\"link\" data={output} filename='monthly-intake.csv'>Download CSV </CSVLink></button>\r\n                    </div>\r\n                </div>\r\n\r\n                <table className=\"table table-striped\" style={{ marginTop: 20 }} >\r\n                    <thead>\r\n                        <tr>\r\n                            <th>First Name</th>\r\n                            <th>Last Name</th>\r\n                            <th>Email</th>\r\n                            <th>Start Date</th>\r\n                        </tr>\r\n                    </thead>               \r\n                    <tbody>\r\n                        {trainees.map(t => {\r\n                            return (\r\n                                <tr>\r\n                                    <td> {t.trainee_fname}</td>\r\n                                    <td> {t.trainee_lname}</td>\r\n                                    <td> {t.trainee_email}</td>\r\n                                    <td> {moment(t.trainee_start_date).format('MMMM Do YYYY')}</td>\r\n                                </tr>\r\n                            );\r\n                        })}\r\n                    </tbody>\r\n\r\n                </table>\r\n            </div>\r\n        );\r\n        }\r\n        else{\r\n\t\t\treturn (\r\n\t\t\t<AccessDenied/>\r\n\t\t\t)\r\n        }\r\n\t}\r\n}"]},"metadata":{},"sourceType":"module"}