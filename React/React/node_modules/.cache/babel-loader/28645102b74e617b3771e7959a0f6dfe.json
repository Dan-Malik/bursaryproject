{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\Chi Zhang\\\\Desktop\\\\QA Bursary project\\\\AWS-Bursary-Project-V1\\\\React\\\\src\\\\components\\\\exportDates..component.js\";\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport axios from 'axios';\nimport CryptoJS from \"react-native-crypto-js\";\nimport { codes } from \"../secrets/secrets.js\";\nimport AccessDenied from './modules/AccessDenied';\nimport { authService } from './modules/authService';\nimport '../css/list-trainee-recruiter.css';\nimport DatePicker from 'react-datepicker';\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { CSVLink } from \"react-csv\";\nimport moment from 'moment';\n\nvar ListTrainee =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ListTrainee, _Component);\n\n  function ListTrainee(props) {\n    var _this;\n\n    _classCallCheck(this, ListTrainee);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ListTrainee).call(this, props));\n\n    _this.filterStartDate = function (e) {\n      _this.setState({\n        searchString: e.toString(),\n        selectedDate: e\n      });\n    };\n\n    _this.state = {\n      trainees: [],\n      searchString: \"\",\n      currentUser: authService.currentUserValue,\n      selectedDate: '',\n      csv: ''\n    }; //Added onChangeSearch - Ernie\n\n    _this.onChangeSearch = _this.onChangeSearch.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(ListTrainee, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      axios.get('http://' + process.env.REACT_APP_AWS_IP + ':4000/trainee/').then(function (response) {\n        var encrypted = response.data;\n        encrypted.map(function (currentTrainee, i) {\n          var bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_email, codes.staff, {\n            iv: codes.iv\n          });\n          currentTrainee.trainee_email = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_fname, codes.trainee);\n          currentTrainee.trainee_fname = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_lname, codes.trainee);\n          currentTrainee.trainee_lname = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_start_date, codes.trainee);\n          currentTrainee.trainee_start_date = bytes.toString(CryptoJS.enc.Utf8);\n          bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_end_date, codes.trainee);\n          currentTrainee.trainee_end_date = bytes.toString(CryptoJS.enc.Utf8);\n\n          if (currentTrainee.trainee_bank_name != undefined && currentTrainee.trainee_account_no != undefined && currentTrainee.trainee_sort_code != undefined) {\n            console.log(currentTrainee.trainee_fname);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_bank_name, codes.trainee);\n            currentTrainee.trainee_bank_name = bytes.toString(CryptoJS.enc.Utf8);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_account_no, codes.trainee);\n            currentTrainee.trainee_account_no = bytes.toString(CryptoJS.enc.Utf8);\n            bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_sort_code, codes.trainee);\n            currentTrainee.trainee_sort_code = bytes.toString(CryptoJS.enc.Utf8);\n          }\n        });\n\n        _this2.setState({\n          trainees: encrypted\n        });\n      }).catch(function (error) {\n        console.log(error);\n      });\n    } // Added onChangeSearch(e) function. Needed for the search filter\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      //Declared variables in order to read input from search function\n      var trainees = this.state.trainees;\n      var search = this.state.searchString;\n      var output = this.state.csv;\n      var role = this.state.currentUser.token.role;\n\n      if (role === 'finance') {\n        output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\", \"Start-Date\", \"End-Date\"]];\n      } else {\n        output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\n      }\n\n      console.log(this.state.searchString);\n\n      if (search.length > 0) {\n        trainees = trainees.filter(function (i) {\n          if (i.trainee_start_date.split(\" \", 4).toString() === search.split(\" \", 4).toString()) {\n            if (role === 'finance') {\n              var obj = [i.trainee_fname, i.trainee_lname, i.trainee_email, i.trainee_bank_name, i.trainee_account_no, i.trainee_sort_code, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\n              output.push(obj);\n              console.log(output);\n              return i;\n            } else if (role === 'admin') {\n              var obj = [i.trainee_fname, i.trainee_lname, i.trainee_email, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\n              output.push(obj);\n              console.log(output);\n              return i;\n            }\n          }\n        });\n      }\n\n      if (this.state.currentUser.token.role === 'finance' || this.state.currentUser.token.role === 'admin') {\n        return React.createElement(\"div\", {\n          className: \"QAtable\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 106\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"QASearchBar\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 107\n          },\n          __self: this\n        }, React.createElement(DatePicker, {\n          selected: this.state.selectedDate,\n          dateFormat: \"dd/MM/yyyy\",\n          placeholderText: \"Specify Start Date to filter\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 108\n          },\n          __self: this\n        }), React.createElement(\"button\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 113\n          },\n          __self: this\n        }, \"Delete\"), React.createElement(\"div\", {\n          id: \"addUser\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 114\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: \"qabtn\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115\n          },\n          __self: this\n        }, React.createElement(CSVLink, {\n          className: \"link\",\n          data: output,\n          filename: \"monthly-intake.csv\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115\n          },\n          __self: this\n        }, \"Download CSV \")))), React.createElement(\"table\", {\n          className: \"table table-striped\",\n          style: {\n            marginTop: 20\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 119\n          },\n          __self: this\n        }, React.createElement(\"thead\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 120\n          },\n          __self: this\n        }, React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 121\n          },\n          __self: this\n        }, React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 122\n          },\n          __self: this\n        }, \"First Name\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 123\n          },\n          __self: this\n        }, \"Last Name\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 124\n          },\n          __self: this\n        }, \"Email\"), React.createElement(\"th\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 125\n          },\n          __self: this\n        }, \"Start Date\"))), React.createElement(\"tbody\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 128\n          },\n          __self: this\n        }, trainees.map(function (t) {\n          return React.createElement(\"tr\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 131\n            },\n            __self: this\n          }, React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 132\n            },\n            __self: this\n          }, \" \", t.trainee_fname), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 133\n            },\n            __self: this\n          }, \" \", t.trainee_lname), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134\n            },\n            __self: this\n          }, \" \", t.trainee_email), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 135\n            },\n            __self: this\n          }, \" \", moment(t.trainee_start_date).format('MMMM Do YYYY')));\n        }))));\n      } else {\n        return React.createElement(AccessDenied, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147\n          },\n          __self: this\n        });\n      }\n    }\n  }]);\n\n  return ListTrainee;\n}(Component);\n\nexport { ListTrainee as default };","map":{"version":3,"sources":["C:\\Users\\Chi Zhang\\Desktop\\QA Bursary project\\AWS-Bursary-Project-V1\\React\\src\\components\\exportDates..component.js"],"names":["React","Component","Link","axios","CryptoJS","codes","AccessDenied","authService","DatePicker","CSVLink","moment","ListTrainee","props","filterStartDate","e","setState","searchString","toString","selectedDate","state","trainees","currentUser","currentUserValue","csv","onChangeSearch","bind","get","process","env","REACT_APP_AWS_IP","then","response","encrypted","data","map","currentTrainee","i","bytes","AES","decrypt","trainee_email","staff","iv","enc","Utf8","trainee_fname","trainee","trainee_lname","trainee_start_date","trainee_end_date","trainee_bank_name","undefined","trainee_account_no","trainee_sort_code","console","log","catch","error","search","output","role","token","length","filter","split","obj","format","push","marginTop","t"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport CryptoJS from \"react-native-crypto-js\";\r\nimport { codes } from \"../secrets/secrets.js\";\r\nimport AccessDenied from './modules/AccessDenied';\r\nimport { authService } from './modules/authService';\r\nimport '../css/list-trainee-recruiter.css';\r\nimport DatePicker from 'react-datepicker';\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\nimport { CSVLink } from \"react-csv\";\r\nimport moment from 'moment';\r\n\r\nexport default class ListTrainee extends Component {\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n\t\t\t\r\n        this.state = {\r\n\t\t\ttrainees: [], \r\n\t\t\tsearchString: \"\",\r\n            currentUser: authService.currentUserValue,\r\n            selectedDate: '',\r\n            csv: ''\r\n\t\t\t};\r\n        \r\n       //Added onChangeSearch - Ernie\r\n        this.onChangeSearch = this.onChangeSearch.bind(this);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        axios.get('http://'+process.env.REACT_APP_AWS_IP+':4000/trainee/')\r\n            .then(response => {\r\n                var encrypted = response.data;\r\n                encrypted.map(function(currentTrainee, i){\r\n                    var bytes  = CryptoJS.AES.decrypt(currentTrainee.trainee_email, codes.staff, {iv: codes.iv});\r\n                    currentTrainee.trainee_email = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_fname, codes.trainee);\r\n                    currentTrainee.trainee_fname = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_lname, codes.trainee);\r\n                    currentTrainee.trainee_lname = bytes.toString(CryptoJS.enc.Utf8);\r\n\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_start_date, codes.trainee);\r\n                    currentTrainee.trainee_start_date = bytes.toString(CryptoJS.enc.Utf8);\r\n                    bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_end_date, codes.trainee);\r\n                    currentTrainee.trainee_end_date = bytes.toString((CryptoJS.enc.Utf8));\r\n                    \r\n                    if(currentTrainee.trainee_bank_name != undefined && currentTrainee.trainee_account_no != undefined && currentTrainee.trainee_sort_code != undefined){\r\n                        console.log(currentTrainee.trainee_fname);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_bank_name, codes.trainee);\r\n                        currentTrainee.trainee_bank_name = bytes.toString(CryptoJS.enc.Utf8);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_account_no, codes.trainee);\r\n                        currentTrainee.trainee_account_no = bytes.toString(CryptoJS.enc.Utf8);\r\n                        bytes = CryptoJS.AES.decrypt(currentTrainee.trainee_sort_code, codes.trainee);\r\n                        currentTrainee.trainee_sort_code = bytes.toString(CryptoJS.enc.Utf8);\r\n                    }\r\n                });\r\n                this.setState({trainees: encrypted});\r\n            })\r\n            .catch(function (error){\r\n                console.log(error);\r\n            })\r\n    }\r\n\r\n    // Added onChangeSearch(e) function. Needed for the search filter\r\n    filterStartDate= (e) =>{\r\n            this.setState({\r\n                searchString: e.toString(),\r\n                selectedDate: e\r\n            });\r\n    }\r\n\t\r\n    render() {\r\n        //Declared variables in order to read input from search function\r\n        let trainees = this.state.trainees;\r\n        let search = this.state.searchString;\r\n        let output = this.state.csv;\r\n        let role = this.state.currentUser.token.role\r\n        if(role === 'finance'){\r\n            output = [[\"First Name\", \"Last Name\", \"Email\", \"Bank Name\", \"Account Number\", \"Sort Number\",\"Start-Date\", \"End-Date\"]];\r\n        }else{\r\n            output = [[\"First Name\", \"Last Name\", \"Email\", \"Start-Date\", \"End-Date\"]];\r\n        }\r\n        \r\n        console.log(this.state.searchString);\r\n        \r\n        if(search.length > 0){\r\n            trainees = trainees.filter(function(i){\r\n                if(i.trainee_start_date.split(\" \", 4).toString() === search.split(\" \", 4).toString()){\r\n                    if(role === 'finance'){\r\n                        var obj =  [i.trainee_fname, i.trainee_lname, i.trainee_email, i.trainee_bank_name, i.trainee_account_no, i.trainee_sort_code, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\r\n                        output.push(obj);\r\n                        console.log(output);\r\n                        return i;\r\n                    } else if(role === 'admin'){\r\n                        var obj =  [i.trainee_fname, i.trainee_lname, i.trainee_email, moment(i.trainee_start_date).format('MMMM Do YYYY'), moment(i.trainee_end_date).format('MMMM Do YYYY')];\r\n                        output.push(obj);\r\n                        console.log(output);\r\n                        return i;\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        if(this.state.currentUser.token.role === 'finance' || this.state.currentUser.token.role === 'admin'){\r\n        return (\r\n            <div className=\"QAtable\">\r\n                <div className=\"QASearchBar\">\r\n                    <DatePicker\r\n                        selected={this.state.selectedDate}\r\n                        dateFormat=\"dd/MM/yyyy\"\r\n                        placeholderText=\"Specify Start Date to filter\"\r\n                    />\r\n                    <button>Delete</button>\r\n                    <div id=\"addUser\">\r\n                        <button className=\"qabtn\"><CSVLink className=\"link\" data={output} filename='monthly-intake.csv'>Download CSV </CSVLink></button>\r\n                    </div>\r\n                </div>\r\n\r\n                <table className=\"table table-striped\" style={{ marginTop: 20 }} >\r\n                    <thead>\r\n                        <tr>\r\n                            <th>First Name</th>\r\n                            <th>Last Name</th>\r\n                            <th>Email</th>\r\n                            <th>Start Date</th>\r\n                        </tr>\r\n                    </thead>               \r\n                    <tbody>\r\n                        {trainees.map(t => {\r\n                            return (\r\n                                <tr>\r\n                                    <td> {t.trainee_fname}</td>\r\n                                    <td> {t.trainee_lname}</td>\r\n                                    <td> {t.trainee_email}</td>\r\n                                    <td> {moment(t.trainee_start_date).format('MMMM Do YYYY')}</td>\r\n                                </tr>\r\n                            );\r\n                        })}\r\n                    </tbody>\r\n\r\n                </table>\r\n            </div>\r\n        );\r\n        }\r\n        else{\r\n\t\t\treturn (\r\n\t\t\t<AccessDenied/>\r\n\t\t\t)\r\n        }\r\n\t}\r\n}"]},"metadata":{},"sourceType":"module"}